<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoxKuu | Digital Art</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://noxkuuimages.blob.core.windows.net/artworks/FaviChick.png">
    <link rel="shortcut icon" href="https://noxkuuimages.blob.core.windows.net/artworks/FaviChick.png" type="image/x-icon">
    <link rel="apple-touch-icon" href="https://noxkuuimages.blob.core.windows.net/artworks/FaviChick.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500;700&family=Permanent+Marker&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            --bg-color: #fdf8f6; --text-color: #57534e; --header-bg: rgba(253, 248, 246, 0.8);
            --border-color: #e7e5e4; --accent-color: #a78bfa; --accent-hover-color: #8b5cf6;
            --inactive-filter-bg: #ffffff; --inactive-filter-hover-bg: #f5f5f4;
            --filter-box-bg: #f5f3ff; /* Lighter pastel purple for filter box */
            @apply transition-colors duration-300;
        }
        .dark body {
            --bg-color: #1c1917; --text-color: #d6d3d1; --header-bg: rgba(28, 25, 23, 0.8);
            --border-color: #44403c; --accent-hover-color: #c4b5fd; --inactive-filter-bg: #292524;
            --inactive-filter-hover-bg: #44403c;
            --filter-box-bg: #292524; /* Dark mode equivalent for filter box */
        }
        .font-heading { font-family: 'Permanent Marker', cursive; }
        .font-body-alt { font-family: 'Caveat', cursive; }
        body { background-color: var(--bg-color); color: var(--text-color); }
        .bg-header { background-color: var(--header-bg); } .border-themed { border-color: var(--border-color); }
        .text-accent { color: var(--accent-color); } .bg-accent { background-color: var(--accent-color); }
        .hover-bg-accent:hover { background-color: var(--accent-hover-color); }
        .bg-inactive-filter { background-color: var(--inactive-filter-bg); }
        .hover-bg-inactive-filter:hover { background-color: var(--inactive-filter-hover-bg); }
        .modal-bg { background-color: rgba(253, 248, 246, 0.9); }
        .dark .modal-bg { background-color: rgba(28, 25, 23, 0.9); }
        .bg-filter-box { background-color: var(--filter-box-bg); }

        /* Custom styles for the dropdown select elements */
        .custom-select {
           -webkit-appearance: none;
           -moz-appearance: none;
           appearance: none;
           /* Custom arrow for light mode */
           background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2357534e' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
           background-position: right 0.75rem center;
           background-repeat: no-repeat;
           background-size: 1.25em 1.25em;
           padding-right: 2.75rem; /* Make space for the arrow */
        }
       .dark .custom-select {
            /* Custom arrow for dark mode */
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23d6d3d1' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
       }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- HEADER -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-header backdrop-blur-md border-b border-themed">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" id="homeLink" class="flex items-center gap-3">
                <img src="https://noxkuuimages.blob.core.windows.net/artworks/FaviChick.png" alt="NoxKuu Logo" class="h-8 w-8">
                <span class="text-2xl font-bold tracking-wider text-stone-800 dark:text-white font-heading">NOXKUU</span>
            </a>
            <div class="flex items-center gap-4">
                <button id="theme-toggle" class="p-2 rounded-full text-stone-500 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800 focus:outline-none">
                    <svg id="theme-toggle-light-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <svg id="theme-toggle-dark-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT (Landing Page) -->
    <div id="main-content">
        <main>
            <section class="text-center pt-32 pb-16 md:pt-48 md:pb-24 px-4">
                <div class="z-10">
                    <h1 class="font-heading text-5xl md:text-7xl lg:text-8xl font-bold text-stone-800 dark:text-white tracking-normal">Illustrating Cool Ideas.</h1>
                    <p class="font-body-alt mt-4 text-2xl md:text-3xl text-stone-500 dark:text-stone-400 max-w-2xl mx-auto">A personal collection of whatever seems cool at the moment.</p>
                </div>
            </section>

            <section id="recent-work" class="py-20 md:py-32 bg-white dark:bg-[#111111]">
                <div class="container mx-auto px-6">
                    <h2 class="font-heading text-4xl md:text-5xl font-bold text-center mb-12 text-stone-800 dark:text-white">Recent <span class="text-accent">Work</span></h2>
                    <div id="recent-gallery-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                        <!-- Recent gallery items will be dynamically inserted here -->
                    </div>
                    <div class="text-center mt-16">
                        <button id="view-full-gallery-btn" class="bg-accent hover-bg-accent text-white font-bold py-3 px-8 rounded-lg text-lg transition-colors duration-300 font-body-alt text-2xl">View Full Gallery</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- FULL GALLERY PAGE -->
    <div id="gallery-page" class="hidden">
        <section class="py-24 md:py-32">
            <div class="container mx-auto px-6">
                <h2 class="font-heading text-4xl md:text-5xl font-bold text-center mb-4 text-stone-800 dark:text-white">Full <span class="text-accent">Gallery</span></h2>
                <p class="text-center text-stone-500 dark:text-stone-400 mb-12">Filter by universe</p>
                <div id="filter-container" class="flex flex-wrap justify-center gap-4 mb-12"></div>
                <div id="full-gallery-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
        </section>
    </div>
    
    <!-- FOOTER -->
    <footer id="contact" class="bg-stone-800 dark:bg-black py-8">
        <div class="container mx-auto px-6 flex justify-between items-center text-stone-400">
            <div>
                <a href="https://instagram.com/noxkuuart" target="_blank" class="flex items-center space-x-2 text-stone-300 hover:text-white transition-colors duration-300">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12.315 2c-4.013 0-4.484.018-6.058.087C4.603 2.158 3.597 2.478 2.78 3.294S1.157 4.6 1.087 6.26c-.07 1.574-.087 2.045-.087 6.058s.018 4.484.087 6.058C1.157 20.097 1.478 21.102 2.294 21.92s1.492 1.134 3.155 1.204C6.83 23.182 7.302 23.2 11.315 23.2s4.484-.018 6.058-.087c1.662-.07 2.668-.39 3.484-1.204s1.134-1.492 1.204-3.155c.07-1.574.087-2.045.087-6.058s-.018-4.484-.087-6.058C23.242 4.603 22.922 3.597 22.106 2.78S21.097 1.478 19.434 1.408C17.86 1.34 17.39 1.322 13.315 1.322H12.315zM12 7.045c-2.73 0-4.955 2.225-4.955 4.955S9.27 16.955 12 16.955s4.955-2.225 4.955-4.955S14.73 7.045 12 7.045zm0 8.084c-1.728 0-3.129-1.4-3.129-3.129s1.4-3.129 3.129-3.129 3.129 1.4 3.129 3.129-1.4 3.129-3.129 3.129zM18.883 6.13a1.47 1.47 0 100-2.94 1.47 1.47 0 000 2.94z" clip-rule="evenodd" /></svg>
                    <span>@noxkuuart</span>
                </a>
                <p class="text-stone-500 text-xs mt-2">&copy; <span id="year"></span> Noxkuu.com</p>
            </div>
            <div>
                <img src="https://noxkuuimages.blob.core.windows.net/artworks/Signature.png" alt="NoxKuu Signature" class="h-20">
            </div>
        </div>
    </footer>

    <!-- MODAL -->
    <div id="imageModal" class="fixed top-0 left-0 w-full h-full modal-bg items-start md:items-center justify-center p-4 z-[100] hidden overflow-y-auto">
         <button id="closeModalBtn" class="absolute top-4 right-4 p-2 z-[110] rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors">
            <span class="text-stone-800 dark:text-white text-5xl font-bold cursor-pointer leading-none">&times;</span>
        </button>
        <div class="relative w-full max-w-7xl mx-auto my-8 flex flex-col md:flex-row items-center justify-center gap-8">
            <div class="relative w-full md:w-2/3 flex items-center justify-center">
                <button id="prevBtn" class="absolute left-0 text-stone-700 dark:text-stone-200 text-4xl p-2 rounded-full bg-white/50 dark:bg-black/30 hover:bg-white/80 dark:hover:bg-black/50 transition-colors">&#10094;</button>
                <img id="modalImage" src="" alt="Full-size artwork" class="max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl">
                <button id="nextBtn" class="absolute right-0 text-stone-700 dark:text-stone-200 text-4xl p-2 rounded-full bg-white/50 dark:bg-black/30 hover:bg-white/80 dark:hover:bg-black/50 transition-colors">&#10095;</button>
            </div>
            <div class="w-full md:w-1/3 flex flex-col justify-center text-left">
                <div id="lore-panel" class="bg-white dark:bg-stone-800/50 p-6 rounded-lg shadow-lg border border-themed">
                    <h3 class="font-heading text-3xl text-stone-800 dark:text-white">Character Lore</h3>
                    <div id="lore-container" class="mt-4 text-stone-600 dark:text-stone-300 space-y-2 leading-relaxed"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const dom = {
                themeToggle: document.getElementById('theme-toggle'), homeLink: document.getElementById('homeLink'),
                mainContent: document.getElementById('main-content'), galleryPage: document.getElementById('gallery-page'),
                viewFullGalleryBtn: document.getElementById('view-full-gallery-btn'), recentGallery: document.getElementById('recent-gallery-container'),
                fullGallery: document.getElementById('full-gallery-container'), filterContainer: document.getElementById('filter-container'),
                modal: document.getElementById('imageModal'), closeModalBtn: document.getElementById('closeModalBtn'),
                modalImg: document.getElementById('modalImage'), prevBtn: document.getElementById('prevBtn'),
                nextBtn: document.getElementById('nextBtn'), loreContainer: document.getElementById('lore-container'),
                yearSpan: document.getElementById('year'),
            };

            const state = {
                allArtwork: [], modalGallery: [], currentModalIndex: 0, categoryTree: {},
            };

            const config = {
                geminiApiKey: "AIzaSyAgl2kPBCxQJg4PVY9kwIPpl22dT8iFRC8"
            };
            
            const artworkData = [
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/StarWars-Jedi.png', alt: 'Artwork of Jedi', primary: ['tv & film', 'comics'], secondary: ['star-wars', 'disney'], flavorText: 'A Jedi Knight from the Star Wars Old Republic era' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/Marvel-Daredevil.png', alt: 'Artwork of DareDevil', primary: ['comics', 'tv & film'], secondary: ['marvel', 'disney'], flavorText: 'Matt Murdock, the Daredevil of Hell\'s Kitchen' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/DC-Superman.png', alt: 'Artwork of Superman', primary: ['comics', 'tv & film'], secondary: ['dc', 'justice league'], flavorText: 'Superman, the Man of Steel' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/DC-CassandraCain.png', alt: 'Artwork of Cassandra Cain', primary: ['comics'], secondary: ['dc', 'batman'], flavorText: 'Cassandra Cain as Batgirl' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/Marvel-Mystique.png', alt: 'Artwork of Mystique', primary: ['comics', 'tv & film'], secondary: ['marvel', 'X-Men', 'disney'], flavorText: 'Mystique, the shape-shifting mutant' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/Marvel-JeanGrayPhoenix.png', alt: 'Artwork of Jean Gray Phoenix', primary: ['comics', 'tv & film'], secondary: ['marvel', 'X-Men', 'disney'], flavorText: 'Jean Grey as the cosmic entity Dark Phoenix' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/Marvel-MoonKnight.png', alt: 'Artwork of Moonknight', primary: ['comics', 'tv & film'], secondary: ['marvel', 'disney'], flavorText: 'Marc Spector, the avatar of the Egyptian moon god Khonshu' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/OC-SkaterDuck.png', alt: 'Artwork of Skater Duck', primary: ['original'], secondary: [], flavorText: '' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/Pokemon-Eevee.png', alt: 'Artwork of Eevee', primary: ['games', 'anime & manga'], secondary: ['pokemon'], flavorText: 'Eevee, Dex number 133 entry gen 1' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/OC-SmokerChick.png', alt: 'Artwork of Girl smoking', primary: ['original'], secondary: [], flavorText: '' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/FairyTail-Nastu.png', alt: 'Artwork of Nastu Dragneel', primary: ['anime & manga'], secondary: ['fairy-tail'], flavorText: 'Natsu Dragneel, the Fire Dragon Slayer from the Fairy Tail guild' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/PowerRangrs-ThomasOliver.png', alt: 'Artwork of Tommy Oliver', primary: ['tv & film', 'comics'], secondary: ['power-rangers'], flavorText: 'The legendary Power Ranger, Tommy Oliver, as the mighty Green Ranger.' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/JuJutsuKaisen-Gojo.png', alt: 'Artwork of Satoru Gojo', primary: ['anime & manga'], secondary: ['jujutsu-kaisen'], flavorText: 'The strongest Jujutsu Sorcerer of the modern era, Satoru Gojo.' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/TheOwlHouse-King.jpg', alt: 'Artwork of King the Titan', primary: ['cartoon', 'tv & film'], secondary: ['the owl house', 'disney'], flavorText: 'The last standing very small titan of the Boiling Isles, the cutiest boy King.' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/LoL-Jinx.png', alt: 'Artwork of Jinx', primary: ['games', 'tv & film'], secondary: ['LoL'], flavorText: 'The crazy, the beautiful and the damn right explosive Jinx. born in Zaun to the name Powder.' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/SuperMario-PrincessPeach.png', alt: 'Artwork of Princess Peach', primary: ['games', 'tv & film'], secondary: ['Mario'], flavorText: 'Ruler of the Mushroom Kingdom and maybe Marios girlfriend Princess Peach' },
                { src: 'https://noxkuuimages.blob.core.windows.net/artworks/MHA-Toga.png', alt: 'Artwork of Toga Himiko', primary: ['anime & manga',], secondary: ['my hero academia'], flavorText: 'Member of the League of Villains, with her Quirk Transform she must taste the blood of who she wishes to become.' },
            ];

            const applyTheme = (theme) => {
                const lightIcon = dom.themeToggle.querySelector('#theme-toggle-light-icon');
                const darkIcon = dom.themeToggle.querySelector('#theme-toggle-dark-icon');
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    lightIcon.style.display = 'block';
                    darkIcon.style.display = 'none';
                } else {
                    document.documentElement.classList.remove('dark');
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'block';
                }
            };
            
            const showPage = (page) => {
                dom.mainContent.style.display = page === 'main' ? 'block' : 'none';
                dom.galleryPage.style.display = page === 'gallery' ? 'block' : 'none';
                window.scrollTo(0, 0);
            };

            const openModal = (element, nodeList, artwork) => {
                state.modalGallery = nodeList;
                dom.modal.style.display = 'flex';
                dom.modalImg.src = element.src;
                state.currentModalIndex = state.modalGallery.findIndex(img => img.src === element.src);
                document.body.style.overflow = 'hidden';
                fetchAndDisplayLore(artwork);
            };

            const closeModal = () => {
                dom.modal.style.display = 'none';
                document.body.style.overflow = '';
            };

            const changeImage = (direction) => {
                state.currentModalIndex = (state.currentModalIndex + direction + state.modalGallery.length) % state.modalGallery.length;
                const newImgSrc = state.modalGallery[state.currentModalIndex].src;
                dom.modalImg.src = newImgSrc;
                const newArtworkData = state.allArtwork.find(art => art.src === newImgSrc);
                fetchAndDisplayLore(newArtworkData);
            };

            const populateGalleries = () => {
                dom.recentGallery.innerHTML = '';
                state.allArtwork.slice(0, 6).forEach(art => dom.recentGallery.appendChild(createGalleryItem(art)));
                dom.fullGallery.innerHTML = '';
                state.allArtwork.forEach(art => dom.fullGallery.appendChild(createGalleryItem(art)));
            };

            const createGalleryItem = (artwork) => {
                const img = document.createElement('img');
                img.src = artwork.src;
                img.alt = artwork.alt;
                img.className = 'rounded-lg border border-themed hover:border-violet-300 dark:hover:border-violet-500 transition-all duration-300 cursor-pointer w-full';
                const itemDiv = document.createElement('div');
                itemDiv.className = 'gallery-item';
                itemDiv.appendChild(img);
                img.onclick = () => {
                    const currentVisibleItems = Array.from(dom.fullGallery.querySelectorAll('.gallery-item:not(.hidden) img'));
                    openModal(img, currentVisibleItems, artwork);
                };
                return itemDiv;
            };

            const formatCategoryName = (slug) => {
                return slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            };

            const createFilterUI = () => {
                dom.filterContainer.innerHTML = '';
                
                const wrapper = document.createElement('div');
                wrapper.className = 'flex items-center justify-center flex-col sm:flex-row gap-4 p-4 rounded-xl bg-filter-box border border-violet-200 dark:border-stone-700 w-full max-w-lg mx-auto';

                const selectClasses = 'w-full sm:w-auto flex-grow p-3 rounded-lg border-2 border-violet-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-stone-200 focus:border-accent dark:focus:border-accent focus:outline-none cursor-pointer transition-all duration-300 custom-select font-heading font-bold tracking-wider';

                const mainSelect = document.createElement('select');
                mainSelect.id = 'main-category-select';
                mainSelect.className = selectClasses;

                const subSelect = document.createElement('select');
                subSelect.id = 'sub-category-select';
                subSelect.className = selectClasses;
                subSelect.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                subSelect.style.display = 'none';

                const categoryTree = { 'All': {} };
                state.allArtwork.forEach(art => {
                    art.primary.forEach(pCat => {
                        if (!categoryTree[pCat]) {
                            categoryTree[pCat] = new Set();
                        }
                        art.secondary.forEach(sCat => {
                            categoryTree[pCat].add(sCat);
                        });
                    });
                });
                state.categoryTree = categoryTree;

                Object.keys(state.categoryTree).sort().forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = formatCategoryName(cat);
                    mainSelect.appendChild(option);
                });
                
                wrapper.appendChild(mainSelect);
                wrapper.appendChild(subSelect);
                dom.filterContainer.appendChild(wrapper);

                mainSelect.addEventListener('change', handleFilterChange);
                subSelect.addEventListener('change', handleFilterChange);
            };

            const handleFilterChange = (e) => {
                const mainSelect = document.getElementById('main-category-select');
                const subSelect = document.getElementById('sub-category-select');
                const mainCat = mainSelect.value;
                const subCats = state.categoryTree[mainCat];

                if (e && e.target.id === 'main-category-select') {
                    if (subCats && subCats.size > 0) {
                        subSelect.innerHTML = '';
                        
                        const allOption = document.createElement('option');
                        allOption.value = mainCat;
                        allOption.textContent = `All ${formatCategoryName(mainCat)}`;
                        subSelect.appendChild(allOption);

                        subCats.forEach(subCatName => {
                            const option = document.createElement('option');
                            option.value = subCatName;
                            option.textContent = formatCategoryName(subCatName);
                            subSelect.appendChild(option);
                        });
                        
                        subSelect.style.display = 'inline-block';
                        setTimeout(() => {
                            subSelect.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
                        }, 10);
                    } else {
                         subSelect.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                         setTimeout(() => {
                            subSelect.style.display = 'none';
                            subSelect.innerHTML = '';
                         }, 300);
                    }
                }

                let filterTag;
                if (mainCat === 'All') {
                    filterTag = 'all';
                } else if (subSelect.style.display !== 'none' && subSelect.value) {
                    filterTag = subSelect.value;
                } else {
                    filterTag = mainCat;
                }
                filterGallery(filterTag);
            };

            const filterGallery = (tag) => {
                dom.fullGallery.querySelectorAll('.gallery-item').forEach(item => {
                    const imgSrc = item.querySelector('img').src;
                    const artwork = state.allArtwork.find(art => art.src === imgSrc);
                    const itemTags = artwork ? [...artwork.primary, ...artwork.secondary] : [];
                    
                    if (tag === 'all' || itemTags.includes(tag)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            };

            async function getGeminiTextResponse(prompt) {
                if (!config.geminiApiKey || config.geminiApiKey === "PASTE_YOUR_GEMINI_API_KEY_HERE") {
                    return "API Key is missing. Please add it to the script.";
                }
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${config.geminiApiKey}`;
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates && result.candidates[0]?.content?.parts[0]) {
                        return result.candidates[0].content.parts[0].text;
                    }
                    console.error('Invalid response structure:', result);
                    return "Could not retrieve lore at this time.";
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    return "An error occurred while contacting the AI. Please try again later.";
                }
            }
            
            async function fetchAndDisplayLore(artwork) {
                if (artwork.primary.includes('original')) {
                    dom.loreContainer.innerHTML = '<p class="font-body-alt text-xl">A unique creation by NoxKuu.</p>';
                    return;
                }
                dom.loreContainer.innerHTML = '<p class="animate-pulse font-body-alt text-xl">Fetching lore from the archives...</p>';
                const prompt = `Directly provide a brief, interesting lore snippet (under 80 words) for the following character: ${artwork.flavorText || artwork.alt}. Do not add any introductory phrases like "Certainly, here is the lore...". Just provide the lore itself. Focus on their origin or a key defining trait.`;
                const loreText = await getGeminiTextResponse(prompt);
                dom.loreContainer.innerHTML = `<p class="font-body-alt text-xl leading-relaxed">${loreText}</p>`;
            }
            
            function setupEventListeners() {
                dom.viewFullGalleryBtn.addEventListener('click', () => showPage('gallery'));
                dom.homeLink.addEventListener('click', (e) => { e.preventDefault(); showPage('main'); });

                dom.themeToggle.addEventListener('click', () => {
                    const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
                    localStorage.setItem('theme', newTheme);
                    applyTheme(newTheme);
                });
                
                dom.closeModalBtn.addEventListener('click', closeModal);
                dom.modal.addEventListener('click', (e) => { if (e.target === dom.modal) closeModal(); });
                dom.prevBtn.addEventListener('click', (e) => { e.stopPropagation(); changeImage(-1); });
                dom.nextBtn.addEventListener('click', (e) => { e.stopPropagation(); changeImage(1); });
                
                document.addEventListener('keydown', (e) => {
                    if (dom.modal.style.display === 'flex') {
                        if (e.key === 'Escape') closeModal();
                        if (e.key === 'ArrowLeft') changeImage(-1);
                        if (e.key === 'ArrowRight') changeImage(1);
                    }
                });
            }

            function main() {
                dom.yearSpan.textContent = new Date().getFullYear();
                applyTheme(localStorage.getItem('theme') || 'light');
                
                state.allArtwork = artworkData; 
                state.allArtwork.reverse();
                
                if (state.allArtwork.length > 0) {
                    populateGalleries();
                    createFilterUI();
                }
                setupEventListeners();
                handleFilterChange(null);
            }
            
            main();
        });
    </script>
</body>
</html>
